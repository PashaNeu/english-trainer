<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>–§—Ä–∞–∑—ã ‚Äî –û–±—É—á–µ–Ω–∏–µ ‚Ä¢ –ö–∞—Ä—Ç–æ—á–∫–∏ ‚Ä¢ –î–∏–∞–ª–æ–≥–∏</title>
<style>
  :root{
    --bg:#0b1220; --panel:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#94a3b8;
    --accent:#60a5fa; --ok:#22c55e; --warn:#fbbf24; --bad:#ef4444; --border:#1f2a44;
  }
  html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,#081025,#0b1220);color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
  .wrap{max-width:980px;margin:0 auto;padding:16px 14px 120px}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin:6px 0 10px}
  h1{margin:0;font-size:1.1rem;letter-spacing:.3px}
  .tabs{display:grid;grid-template-columns:repeat(3,1fr);border:1px solid var(--border);border-radius:14px;overflow:hidden;margin:6px 0 12px}
  .tabs button{padding:12px 8px;border:0;background:transparent;color:var(--muted);font-weight:700}
  .tabs button.active{background:rgba(255,255,255,.06);color:var(--text)}
  .card{background:rgba(17,24,39,.78);backdrop-filter:blur(6px);border:1px solid var(--border);
        border-radius:16px;padding:14px;margin:8px 0}
  .row{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
  .btn{padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,.05);
       color:var(--text);font-weight:700}
  .btn:active{transform:translateY(1px)}
  .btn.primary{background:rgba(96,165,250,.18);border-color:rgba(96,165,250,.5);color:#dbeafe}
  .btn.good{background:rgba(34,197,94,.14);border-color:rgba(34,197,94,.5);color:#dcfce7}
  .btn.bad{background:rgba(239,68,68,.12);border-color:rgba(239,68,68,.5);color:#fee2e2}
  .btn.warn{background:rgba(251,191,36,.12);border-color:rgba(251,191,36,.5);color:#fef3c7}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  .mute{color:var(--muted)}
  input[type="number"],input[type="text"],textarea,select{width:100%;padding:12px;border-radius:12px;
       border:1px solid var(--border);background:rgba(255,255,255,.05);color:var(--text);font-size:1rem}
  .list{display:grid;grid-template-columns:1fr;gap:10px}
  .item{display:grid;grid-template-columns:52px 1fr auto;align-items:center;gap:10px;
        background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:12px;padding:10px}
  .phrase-en{font-size:1.15rem;font-weight:700}
  .phrase-ru{color:var(--muted);margin-top:6px}
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
  .center{text-align:center}
  .big{font-size:1.25rem}
  footer{position:fixed;left:0;right:0;bottom:0;padding:10px 12px;background:linear-gradient(180deg,rgba(8,16,37,0),rgba(8,16,37,.9));
         border-top:1px solid var(--border);backdrop-filter:blur(6px)}
  .kbd{border:1px solid var(--border);border-bottom-width:3px;border-radius:8px;padding:2px 6px;font-weight:800}
  .success{border-color:rgba(34,197,94,.6)!important}
  .fail{border-color:rgba(239,68,68,.6)!important}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>–¢—Ä–µ–Ω–∞–∂—ë—Ä —Ñ—Ä–∞–∑ ‚Ä¢ –û–±—É—á–µ–Ω–∏–µ / –ö–∞—Ä—Ç–æ—á–∫–∏ / –î–∏–∞–ª–æ–≥–∏</h1>
    <div class="controls">
      <button class="btn" id="importBtn">‚¨Ü –ò–º–ø–æ—Ä—Ç</button>
      <button class="btn" id="exportBtn">‚¨á –≠–∫—Å–ø–æ—Ä—Ç</button>
      <input type="file" id="fileInput" accept="application/json" style="display:none">
    </div>
  </header>

  <div class="tabs">
    <button class="tab active" data-tab="learn">–û–±—É—á–µ–Ω–∏–µ</button>
    <button class="tab" data-tab="cards">–ö–∞—Ä—Ç–æ—á–∫–∏</button>
    <button class="tab" data-tab="dialogs">–î–∏–∞–ª–æ–≥–∏</button>
  </div>

  <!-- LEARN -->
  <section id="learn" class="card">
    <div class="row">
      <div class="mute">–ù–∞–∂–∏–º–∞–π ‚ñ∂ —á—Ç–æ–±—ã —É—Å–ª—ã—à–∞—Ç—å –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ. –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞.</div>
      <div class="controls">
        <button class="btn" id="toggleRu">üëÅ RU</button>
        <button class="btn" id="shuffleLearn">üîÄ –ü–µ—Ä–µ–º–µ—à–∞—Ç—å</button>
        <button class="btn primary" id="autoPlay">‚ñ∂ –ê–≤—Ç–æ–ø–ª–µ–π</button>
        <button class="btn" id="stopPlay">‚èπ –°—Ç–æ–ø</button>
      </div>
    </div>
    <div class="list" id="learnList"></div>
  </section>

  <!-- CARDS -->
  <section id="cards" class="card" style="display:none">
    <div class="row">
      <div class="controls">
        <label class="mute">–ê–≤—Ç–æ–ø–æ–∫–∞–∑ (—Å–µ–∫):</label>
        <input type="number" id="revealSec" min="0" max="10" value="3" style="width:90px">
        <select id="cardOrder">
          <option value="random">–°–ª—É—á–∞–π–Ω–æ</option>
          <option value="sequential" selected>–ü–æ –ø–æ—Ä—è–¥–∫—É</option>
        </select>
        <button class="btn" id="resetCards">‚Üª –°–±—Ä–æ—Å–∏—Ç—å</button>
      </div>
      <div class="mute">–ü–æ–¥—Å–∫–∞–∑–∫–∏: <span class="kbd">Space</span> ‚Äî –¥–∞–ª–µ–µ</div>
    </div>

    <div class="card center" style="min-height:180px">
      <div>
        <div class="mute">–ü–µ—Ä–µ–≤–µ–¥–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π:</div>
        <div id="cardPrompt" class="big" style="margin:8px 0 10px">‚Äî</div>
        <div class="mute">–ü–æ–∫–∞–∑ —á–µ—Ä–µ–∑: <span id="countdown">off</span></div>
        <div id="cardAnswer" class="big mono" style="display:none;margin-top:8px">‚Äî</div>
      </div>
    </div>

    <div class="row">
      <button class="btn bad" id="again">–°–Ω–æ–≤–∞</button>
      <button class="btn good" id="knew">–ó–Ω–∞—é</button>
      <button class="btn warn" id="speakAns">üîä –ü—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏</button>
      <button class="btn" id="nextCard">–î–∞–ª–µ–µ ‚Üí</button>
    </div>

    <div class="row">
      <div class="mute">–ü—Ä–æ–≥—Ä–µ—Å—Å: <span id="cardProgress">0/0</span></div>
      <div class="mute">–°–µ—Ä–∏—è: <span id="streak">0</span></div>
    </div>
  </section>

  <!-- DIALOGS -->
  <section id="dialogs" class="card" style="display:none">
    <div class="row">
      <div class="mute">–ó–∞–¥–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º ‚Üí –æ—Ç–≤–µ—Ç –ø–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏. –ú–æ–∂–Ω–æ –ø–æ–¥—Å–º–æ—Ç—Ä–µ—Ç—å/–ø—Ä–æ—Å–ª—É—à–∞—Ç—å –æ—Ç–≤–µ—Ç.</div>
      <div class="controls">
        <button class="btn" id="shuffleDlg">üîÄ –ü–µ—Ä–µ–º–µ—à–∞—Ç—å</button>
        <button class="btn" id="resetDlg">‚Üª –°–±—Ä–æ—Å–∏—Ç—å</button>
      </div>
    </div>

    <div class="card">
      <div class="mute">–ó–∞–¥–∞–Ω–∏–µ:</div>
      <div id="dlgPrompt" class="big" style="margin:6px 0 10px">‚Äî</div>

      <input id="dlgInput" placeholder="–ù–∞–ø–∏—à–∏ –æ—Ç–≤–µ—Ç –ø–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏‚Ä¶" autocomplete="off">
      <div class="controls" style="margin-top:10px">
        <button class="btn primary" id="checkDlg">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        <button class="btn" id="revealDlg">–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</button>
        <button class="btn warn" id="speakDlg">üîä –ü—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏</button>
        <button class="btn" id="nextDlg">–î–∞–ª–µ–µ ‚Üí</button>
      </div>
      <div id="dlgFeedback" class="mute" style="margin-top:6px"></div>
      <div id="dlgAnswer" class="mono" style="display:none;margin-top:6px"></div>
    </div>

    <div class="row">
      <div class="mute">–ü—É–Ω–∫—Ç: <span id="dlgIdx">0/0</span></div>
      <div class="mute">–í–µ—Ä–Ω–æ: <span id="dlgOk">0</span></div>
    </div>
  </section>

</div>

<footer>
  <div class="row" style="justify-content:space-between">
    <div class="mute">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ ‚Ä¢ <span id="tz"></span></div>
    <div class="mute">–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏: <span class="kbd">Space</span> ‚Äî –¥–∞–ª–µ–µ</div>
  </div>
</footer>

<script>
(function(){
  // ===== Data =====
  const defaultData = [
    {"en":"How‚Äôs it going?","ru":"–ö–∞–∫ –¥–µ–ª–∞?"},
    {"en":"Long time no see!","ru":"–î–∞–≤–Ω–æ –Ω–µ –≤–∏–¥–µ–ª–∏—Å—å!"},
    {"en":"What do you mean?","ru":"–ß—Ç–æ —Ç—ã –∏–º–µ–µ—à—å –≤ –≤–∏–¥—É?"},
    {"en":"I don‚Äôt get it.","ru":"–Ø –Ω–µ –ø–æ–Ω–∏–º–∞—é."},
    {"en":"Could you repeat, please?","ru":"–ü–æ–≤—Ç–æ—Ä–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞."},
    {"en":"Never mind.","ru":"–ù–µ–≤–∞–∂–Ω–æ / –ó–∞–±—É–¥—å."},
    {"en":"That makes sense.","ru":"–õ–æ–≥–∏—á–Ω–æ."},
    {"en":"It doesn‚Äôt matter.","ru":"–≠—Ç–æ –Ω–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è."},
    {"en":"Take care!","ru":"–ë–µ—Ä–µ–≥–∏ —Å–µ–±—è!"},
    {"en":"Don‚Äôt worry.","ru":"–ù–µ –≤–æ–ª–Ω—É–π—Å—è."},
    {"en":"It‚Äôs up to you.","ru":"–¢–µ–±–µ —Ä–µ—à–∞—Ç—å."},
    {"en":"I‚Äôll think about it.","ru":"–Ø –ø–æ–¥—É–º–∞—é."},
    {"en":"Sounds good!","ru":"–ó–≤—É—á–∏—Ç —Ö–æ—Ä–æ—à–æ!"},
    {"en":"I‚Äôm on my way.","ru":"–Ø —É–∂–µ –≤ –ø—É—Ç–∏."},
    {"en":"Just a second.","ru":"–°–µ–∫—É–Ω–¥—É."},
    {"en":"I‚Äôm not sure.","ru":"–Ø –Ω–µ —É–≤–µ—Ä–µ–Ω."},
    {"en":"I don‚Äôt feel like it.","ru":"–ú–Ω–µ –Ω–µ —Ö–æ—á–µ—Ç—Å—è."},
    {"en":"It happens.","ru":"–ë—ã–≤–∞–µ—Ç."},
    {"en":"You‚Äôre welcome.","ru":"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞."},
    {"en":"Same here.","ru":"–¢–æ –∂–µ —Å–∞–º–æ–µ."},
    {"en":"I can‚Äôt wait!","ru":"–ù–µ –º–æ–≥—É –¥–æ–∂–¥–∞—Ç—å—Å—è!"},
    {"en":"Let‚Äôs do it!","ru":"–î–∞–≤–∞–π —Å–¥–µ–ª–∞–µ–º —ç—Ç–æ!"},
    {"en":"Take your time.","ru":"–ù–µ —Ç–æ—Ä–æ–ø–∏—Å—å."},
    {"en":"I changed my mind.","ru":"–Ø –ø–µ—Ä–µ–¥—É–º–∞–ª."},
    {"en":"Absolutely!","ru":"–ê–±—Å–æ–ª—é—Ç–Ω–æ!"}
  ];
  const LS = 'phrases_v2';
  const getData = ()=>{
    const s = localStorage.getItem(LS);
    try{return s? JSON.parse(s): defaultData.slice();}catch(e){return defaultData.slice();}
  };
  const setData = (d)=> localStorage.setItem(LS, JSON.stringify(d));

  // ===== Utils =====
  const $ = (id)=>document.getElementById(id);
  const speak = (text)=>{ try{ const u=new SpeechSynthesisUtterance(text); u.lang='en-US'; u.rate=1.0; u.pitch=1.0; speechSynthesis.speak(u);}catch(e){ alert('TTS –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è'); } };
  const shuffle = (a)=>{ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];} return a; };
  const norm = (s)=> (s||'').toLowerCase().trim().replace(/[.,!?;:'\"()\-]/g,'').replace(/\s+/g,' ');
  const lv = (a,b)=>{ a=a||''; b=b||''; const m=a.length,n=b.length; if(!m) return n; if(!n) return m; const dp=Array(n+1); for(let j=0;j<=n;j++) dp[j]=j; for(let i=1;i<=m;i++){ let prev=i-1,cur; dp[0]=i; for(let j=1;j<=n;j++){ cur=dp[j]; const cost=a[i-1]===b[j-1]?0:1; dp[j]=Math.min(dp[j]+1, dp[j-1]+1, prev+cost); prev=cur; } } return dp[n]; };
  const similar = (a,b)=>{ a=norm(a); b=norm(b); if(!a||!b) return false; const d=lv(a,b); const L=Math.max(a.length,b.length)||1; const r=1-d/L; return r>=0.8 || (d<=2 && L>=5); };

  // ===== Tabs =====
  const tabs = document.querySelectorAll('.tab');
  tabs.forEach(btn=>btn.addEventListener('click',()=>{
    tabs.forEach(b=>b.classList.remove('active')); btn.classList.add('active');
    document.querySelectorAll('section').forEach(s=>s.style.display='none');
    $(btn.dataset.tab).style.display='block';
  }));

  // ===== LEARN =====
  let showRu = true;
  let autoplay = false;
  let apIndex = 0;
  let apTimer = null;

  function renderLearn(){
    const list = $('learnList'); list.innerHTML='';
    const data = getData();
    data.forEach((p,idx)=>{
      const div = document.createElement('div');
      div.className='item';
      div.innerHTML = `
        <button class="btn primary" data-idx="${idx}">‚ñ∂</button>
        <div>
          <div class="phrase-en">${p.en}</div>
          <div class="phrase-ru"${showRu?'':' style="display:none"'}>${p.ru}</div>
        </div>
        <div class="controls">
          <button class="btn" data-say="${idx}">üîä</button>
        </div>`;
      div.querySelector('[data-idx]').addEventListener('click',()=>speak(p.en));
      div.querySelector('[data-say]').addEventListener('click',()=>speak(p.en));
      list.appendChild(div);
    });
  }
  $('toggleRu').addEventListener('click',()=>{ showRu=!showRu; renderLearn(); });
  $('shuffleLearn').addEventListener('click',()=>{ setData(shuffle(getData())); renderLearn(); });
  $('autoPlay').addEventListener('click',()=>{
    if(autoplay) return;
    autoplay=true; apIndex=0;
    const data=getData();
    const playNext=()=>{
      if(!autoplay){clearInterval(apTimer);return;}
      if(apIndex>=data.length){ autoplay=false; return; }
      speak(data[apIndex].en);
      apIndex++;
      apTimer=setTimeout(playNext, 1800);
    };
    playNext();
  });
  $('stopPlay').addEventListener('click',()=>{ autoplay=false; if(apTimer) clearTimeout(apTimer); });

  // ===== CARDS =====
  let queue=[], qIndex=0, seen=0, streak=0, timer=null;
  function initCards(){
    const data=getData();
    queue = data.map((p,i)=>({i,seen:false}));
    if($('cardOrder').value==='random') shuffle(queue);
    qIndex=0; seen=0; streak=0;
    $('cardProgress').textContent=`${seen}/${queue.length}`;
    $('streak').textContent='0';
    nextCard(true);
  }
  function nextCard(first=false){
    if(qIndex>=queue.length) qIndex=0;
    const p = getData()[queue[qIndex].i];
    $('cardPrompt').textContent = p.ru;
    $('cardAnswer').style.display='none'; $('cardAnswer').textContent = p.en;
    const sec = parseInt($('revealSec').value||'0',10);
    if(timer) clearInterval(timer);
    if(sec>0){
      let t=sec; $('countdown').textContent=t;
      timer=setInterval(()=>{ t--; $('countdown').textContent=t; if(t<=0){ clearInterval(timer); $('cardAnswer').style.display='block'; } },1000);
    }else{$('countdown').textContent='off';}
    if(!first) qIndex++;
  }
  function markCard(ok){
    const it = queue[(qIndex-1+queue.length)%queue.length];
    if(!it.seen){ it.seen=true; seen++; }
    ok? (streak++):(streak=0, queue.push(it));
    $('cardProgress').textContent=`${seen}/${queue.length}`;
    $('streak').textContent=String(streak);
  }
  $('resetCards').addEventListener('click',initCards);
  $('nextCard').addEventListener('click',()=>nextCard());
  $('again').addEventListener('click',()=>{ markCard(false); nextCard(); });
  $('knew').addEventListener('click',()=>{ markCard(true); nextCard(); });
  $('speakAns').addEventListener('click',()=>speak($('cardAnswer').textContent));

  // ===== DIALOGS =====
  let dlg=[], di=0, ok=0;
  const buildPrompts=()=>{
    const data=getData();
    const prompts = [
      "–Ø –≤—Å—Ç—Ä–µ—á–∞—é —Ç–µ–±—è –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã. –°–∫–∞–∂–∏: ¬´–ö–∞–∫ –¥–µ–ª–∞?¬ª",
      "–ú—ã –Ω–µ –≤–∏–¥–µ–ª–∏—Å—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Å—è—Ü–µ–≤. –°–∫–∞–∂–∏: ¬´–î–∞–≤–Ω–æ –Ω–µ –≤–∏–¥–µ–ª–∏—Å—å!¬ª",
      "–Ø —Å–∫–∞–∑–∞–ª —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ–µ. –°–ø—Ä–æ—Å–∏: ¬´–ß—Ç–æ —Ç—ã –∏–º–µ–µ—à—å –≤ –≤–∏–¥—É?¬ª",
      "–Ø –æ–±—ä—è—Å–Ω–∏–ª —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ. –°–∫–∞–∂–∏: ¬´–Ø –Ω–µ –ø–æ–Ω–∏–º–∞—é¬ª.",
      "–Ø –≥–æ–≤–æ—Ä—é —Ç–∏—Ö–æ. –ü–æ–ø—Ä–æ—Å–∏: ¬´–ü–æ–≤—Ç–æ—Ä–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞¬ª.",
      "–Ø –∏–∑–≤–∏–Ω–∏–ª—Å—è. –û—Ç–≤–µ—Ç—å: ¬´–ù–µ–≤–∞–∂–Ω–æ / –∑–∞–±—É–¥—å¬ª.",
      "–Ø –æ–±—ä—è—Å–Ω–∏–ª –æ–ø–æ–∑–¥–∞–Ω–∏–µ. –°–∫–∞–∂–∏: ¬´–õ–æ–≥–∏—á–Ω–æ¬ª.",
      "–Ø –∂–∞–ª—É—é—Å—å –Ω–∞ –ø–æ–≥–æ–¥—É. –û—Ç–≤–µ—Ç—å: ¬´–≠—Ç–æ –Ω–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è¬ª.",
      "–ú—ã –ø—Ä–æ—â–∞–µ–º—Å—è. –°–∫–∞–∂–∏: ¬´–ë–µ—Ä–µ–≥–∏ —Å–µ–±—è!¬ª",
      "–Ø –ø–µ—Ä–µ–∂–∏–≤–∞—é. –û—Ç–≤–µ—Ç—å: ¬´–ù–µ –≤–æ–ª–Ω—É–π—Å—è¬ª.",
      "–ö–∞–∫–æ–π —Ñ–∏–ª—å–º —Å–º–æ—Ç—Ä–µ—Ç—å? –û—Ç–≤–µ—Ç—å: ¬´–¢–µ–±–µ —Ä–µ—à–∞—Ç—å¬ª.",
      "–Ø –∑–æ–≤—É –Ω–∞ –≤–µ—á–µ—Ä–∏–Ω–∫—É. –û—Ç–≤–µ—Ç—å: ¬´–Ø –ø–æ–¥—É–º–∞—é¬ª.",
      "–Ø –ø—Ä–µ–¥–ª–∞–≥–∞—é –ø–∏—Ü—Ü—É. –û—Ç–≤–µ—Ç—å: ¬´–ó–≤—É—á–∏—Ç —Ö–æ—Ä–æ—à–æ¬ª.",
      "–Ø —Å–ø—Ä–∞—à–∏–≤–∞—é: ¬´–ì–¥–µ —Ç—ã?¬ª –û—Ç–≤–µ—Ç—å: ¬´–Ø —É–∂–µ –≤ –ø—É—Ç–∏¬ª.",
      "–Ø —Ç–æ—Ä–æ–ø–ª—é —Ç–µ–±—è. –û—Ç–≤–µ—Ç—å: ¬´–°–µ–∫—É–Ω–¥—É¬ª.",
      "–¢—ã –≥–æ—Ç–æ–≤? –û—Ç–≤–µ—Ç—å: ¬´–Ø –Ω–µ —É–≤–µ—Ä–µ–Ω¬ª.",
      "–ü—Ä–µ–¥–ª–∞–≥–∞—é –∑–∞–ª. –û—Ç–≤–µ—Ç—å: ¬´–ú–Ω–µ –Ω–µ —Ö–æ—á–µ—Ç—Å—è¬ª.",
      "–Ø –ø—Ä–æ–ª–∏–ª –∫–æ—Ñ–µ. –û—Ç–≤–µ—Ç—å: ¬´–ë—ã–≤–∞–µ—Ç¬ª.",
      "–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–º–æ—â—å! –û—Ç–≤–µ—Ç—å: ¬´–ü–æ–∂–∞–ª—É–π—Å—Ç–∞¬ª.",
      "–Ø —É—Å—Ç–∞–ª. –û—Ç–≤–µ—Ç—å: ¬´–Ø —Ç–æ–∂–µ¬ª.",
      "–ö–æ–Ω—Ü–µ—Ä—Ç –∑–∞–≤—Ç—Ä–∞! –û—Ç–≤–µ—Ç—å: ¬´–ù–µ –º–æ–≥—É –¥–æ–∂–¥–∞—Ç—å—Å—è!¬ª",
      "–ù–∞—á–Ω—ë–º —Å–µ–π—á–∞—Å? –û—Ç–≤–µ—Ç—å: ¬´–î–∞–≤–∞–π —Å–¥–µ–ª–∞–µ–º —ç—Ç–æ!¬ª",
      "–Ø —Ç–æ—Ä–æ–ø–ª—é. –û—Ç–≤–µ—Ç—å: ¬´–ù–µ —Ç–æ—Ä–æ–ø–∏—Å—å¬ª.",
      "–¢—ã –ø–µ—Ä–µ–¥—É–º–∞–ª. –°–∫–∞–∂–∏: ¬´–Ø –ø–µ—Ä–µ–¥—É–º–∞–ª¬ª.",
      "–¢—ã –ª—é–±–∏—à—å –º–æ—Ä–æ–∂–µ–Ω–æ–µ? –û—Ç–≤–µ—Ç—å: ¬´–ê–±—Å–æ–ª—é—Ç–Ω–æ!¬ª"
    ];
    dlg = getData().map((p,i)=>({prompt:prompts[i]||p.ru, ans:p.en}));
  };
  function initDlg(){
    buildPrompts(); shuffle(dlg); di=0; ok=0; renderDlg();
  }
  function renderDlg(){
    const it=dlg[di];
    $('dlgPrompt').textContent = it.prompt;
    $('dlgInput').value=''; $('dlgInput').classList.remove('success','fail');
    $('dlgFeedback').textContent='';
    $('dlgAnswer').style.display='none'; $('dlgAnswer').textContent='–û—Ç–≤–µ—Ç: '+it.ans;
    $('dlgIdx').textContent = `${di+1}/${dlg.length}`;
    $('dlgOk').textContent = String(ok);
    $('dlgInput').focus();
  }
  function checkDlg(){
    const it=dlg[di];
    const val=$('dlgInput').value;
    if(similar(val,it.ans)){
      $('dlgInput').classList.add('success');
      $('dlgFeedback').innerHTML='<span style="color:var(--ok)">‚úì –í–µ—Ä–Ω–æ</span>';
      ok++; setTimeout(nextDlg, 450);
    }else{
      $('dlgInput').classList.add('fail');
      $('dlgFeedback').innerHTML='<span style="color:var(--bad)">‚úó –ù–µ —Å–æ–≤—Å–µ–º</span>';
    }
    $('dlgOk').textContent = String(ok);
  }
  function nextDlg(){ di=(di+1)%dlg.length; renderDlg(); }

  $('checkDlg').addEventListener('click',checkDlg);
  $('revealDlg').addEventListener('click',()=>{ $('dlgAnswer').style.display='block'; speak(dlg[di].ans); });
  $('speakDlg').addEventListener('click',()=>speak(dlg[di].ans));
  $('nextDlg').addEventListener('click',nextDlg);
  $('shuffleDlg').addEventListener('click',()=>{ shuffle(dlg); renderDlg(); });
  $('resetDlg').addEventListener('click',initDlg);

  // ===== Import / Export =====
  $('importBtn').addEventListener('click',()=>$('fileInput').click());
  $('fileInput').addEventListener('change',(e)=>{
    const f=e.target.files[0]; if(!f) return;
    const reader = new FileReader();
    reader.onload=()=>{
      try{
        const data=JSON.parse(reader.result);
        if(!Array.isArray(data)) throw new Error('JSON –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º –æ–±—ä–µ–∫—Ç–æ–≤ {en,ru}');
        setData(data); renderLearn(); initCards(); initDlg(); alert('–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ');
      }catch(err){ alert('–û—à–∏–±–∫–∞ JSON: '+err.message); }
    };
    reader.readAsText(f);
  });
  $('exportBtn').addEventListener('click',()=>{
    const blob=new Blob([JSON.stringify(getData(),null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob); const a=document.createElement('a');
    a.href=url; a.download='phrases.json'; a.click(); setTimeout(()=>URL.revokeObjectURL(url),1500);
  });

  // ===== Shortcuts =====
  document.addEventListener('keydown',(e)=>{
    if(e.key===' '){
      if(getComputedStyle($('cards')).display!=='none') $('nextCard').click();
      if(getComputedStyle($('dialogs')).display!=='none') $('nextDlg').click();
    }
  });

  // ===== Init =====
  try{ $('tz').textContent = Intl.DateTimeFormat().resolvedOptions().timeZone || ''; }catch(e){}
  renderLearn(); initCards(); initDlg();
})();
</script>
</body>
</html>